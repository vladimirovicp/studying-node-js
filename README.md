# studying-node-js

https://habr.com/ru/companies/ruvds/articles/424969/ \
https://webformyself.com/node-js-fs-fajlovaya-sistema/ /

### Содержание
* [Открытие файла | #fs.open](#fs.open)
* [Получение информации о файлах | fs.stat](#fs.stat)
* [Чтение файла | fs.read](#fs.read)



## Работа с файловыми дескрипторами в Node.js

### <a name="fs.open">Открытие файла</a>
Синтаксис. Ниже приведен синтаксис метода для открытия файла в асинхронном режиме:
```
fs.open(path, flags[, mode], callback)
```
**Параметры**\
Ниже приводится описание используемых параметров —
* path — это строка с именем файла, включая путь к нему.
* flags — указывают режим работы с файлом, который нужно открыть. Все возможные значения приведены ниже.
* mode — устанавливает режим файла (права доступа), но только если файл был создан. По умолчанию — 0666, чтение и запись.
* callback — это функция обратного вызова, которая принимает два аргумента (err, fd).

Прежде чем вы сможете взаимодействовать с файлами, находящимися в файловой системе вашего сервера, вам необходимо получить дескриптор файла.\
Дескриптор можно получить, воспользовавшись для открытия файла асинхронным методом open() из модуля fs:
```
const fs = require('fs')
fs.open('/Users/flavio/test.txt', 'r', (err, fd) => {
  //fd - это дескриптор файла
})
```
Обратите внимание на второй параметр, r, использованный при вызове метода fs.open(). Это — флаг, который сообщает системе о том, что файл открывают для чтения. Вот ещё некоторые флаги, которые часто используются при работе с этим и некоторыми другими методами:

>* r+ — открыть файл для чтения и для записи.
>* w+ — открыть файл для чтения и для записи, установив указатель потока в начало файла. Если файл не существует — он создаётся.
>* a — открыть файл для записи, установив указатель потока в конец файла. Если файл не существует — он создаётся.
>* a+ — открыть файл для чтения и записи, установив указатель потока в конец файла. Если файл не существует — он создаётся.

Файлы можно открывать и пользуясь синхронным методом fs.openSync(), который, вместо того, чтобы предоставить дескриптор файла в коллбэке, возвращает его:
```
const fs = require('fs')
try {
  const fd = fs.openSync('/Users/flavio/test.txt', 'r')
} catch (err) {
  console.error(err)
}
```
После получения дескриптора любым из вышеописанных способов вы можете производить с ним необходимые операции.

### <a name="fs.stat">Получение информации о файлах</a>
Синтаксис. Ниже приведен синтаксис метода для получения информации о файле:
```
fs.stat(path, callback)
```
Параметры \
Ниже приводится описание используемых параметров —
* path — это строка с именем файла, включая путь к нему.
* callback — это функция обратного вызова, которая принимает два аргумента (err, stats), где stats — это объект типа fs.Stats, который приведен в примере ниже.
  
Помимо атрибутов, которые приведены в примере ниже, в классе fs.Stats содержится несколько важных методов, которые можно использовать для проверки типа файла. Эти методы приведены в следующей таблице.
* stats.isDirectory() — Возвращает true, если тип файла — каталог.
* stats.isBlockDevice() — Возвращает true, если тип файла — блочное устройство.
* stats.isCharacterDevice() — Возвращает true, если тип файла — символьное устройство.
* stats.isSymbolicLink() — Возвращает true, если тип файла — символьная ссылка.
* stats.isFIFO() — Возвращает true, если тип файла — FIFO.
* stats.isSocket() — Возвращает true, если тип файла — сокет.
**Пример**
```
var fs = require("fs");
 
console.log("Going to get file info!");
fs.stat('input.txt', function (err, stats) {
   if (err) {
       return console.error(err);
   }
   console.log(stats);
   console.log("Got file info successfully!");
   
   // Check file type
   console.log("isFile ? " + stats.isFile());
   console.log("isDirectory ? " + stats.isDirectory());    
});
```

### <a name="fs.read">Чтение файла</a>
Синтаксис. Ниже приведен синтаксис одного из методов чтения из файла:
```
fs.read(fd, buffer, offset, length, position, callback)
```
Этот метод использует для чтения файла файловый дескриптор. Если вы хотите считать файл напрямую, с помощью имени файла, используйте другой метод. \
**Параметры**
Ниже приводится описание используемых параметров:
* fd — это дескриптор файла, возвращаемый функцией fs.open().
* buffer — это буфер, в который будут записаны данные.
* offset — это смещение в буфере к позиции начала записи.
* length — это целое число, определяющее количество прочитанных байтов.
* position — Это целое число, указывающее, с какой позиции должно начинаться чтение файла. Если позиция равна нулю, данные будут считываться с текущей позиции файла.
* callback — это функция обратного вызова, которая принимает три аргумента (err, bytesRead, buffer).
**Пример**
```
var fs = require("fs");
var buf = new Buffer(1024);
 
console.log("Going to open an existing file");
fs.open('input.txt', 'r+', function(err, fd) {
   if (err) {
      return console.error(err);
   }
   console.log("File opened successfully!");
   console.log("Going to read the file");
   fs.read(fd, buf, 0, buf.length, 0, function(err, bytes){
      if (err){
         console.log(err);
      }
      console.log(bytes + " bytes read");
      
      // Print only read bytes to avoid junk.
      if(bytes > 0){
         console.log(buf.slice(0, bytes).toString());
      }
   });
});
```
